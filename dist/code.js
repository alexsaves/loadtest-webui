var ControlForm=function(t){this.frm=$(t),this.els=this.frm.find("input, select, textarea");var s={},e=!0,r=[];this.els.each(function(t,n){s[n.id]=$.trim(n.value),"number"==n.type&&(s[n.id]=parseFloat(n.value)),"yes"==n.getAttribute("required")&&0===s[n.id].toString().length&&(e=!1,r.push(n.getAttribute("aria-describedby")?$("#"+n.getAttribute("aria-describedby")).html():n.id))}),e?(currentTest=s,$("#messageZone").addClass("hidden"),Display("progressform"),$.ajax({type:"POST",url:"/begin",data:s,success:function(t){t.success||($("#messagetext").html(t.msg),$("#messageZone").removeClass("hidden"),Display("controlform"))}})):($("#messagetext").html("Some required fields are missing or invalid: "+r.join(", ")),$("#messageZone").removeClass("hidden")),this.vals=s},Display=function(t){$(".zonearea").each(function(s,e){e.id==t?$(e).removeClass("hidden"):$(e).addClass("hidden")})};$(document).ready(function(){$("#starttestbutton").click(function(t){t.stopPropagation(),t.preventDefault();new ControlForm($("#controlfrm")[0])}),$("#controlfrm").on("submit",function(t){t.preventDefault(),e.stopPropagation();new ControlForm(this)}),$("#startoverbutton, #cancelbutton").click(function(t){t.stopPropagation(),t.preventDefault(),$.ajax({type:"POST",url:"/startover",success:function(t){}})});new statusChecker,new progressor});var progressor=function(){var t=this;this._progTimer=setInterval(function(){t.update()},500)};progressor.prototype.update=function(){if(currentTest.results&&currentTest.results.testResults){var t=parseInt(currentTest.results.testInfo.secs),s=currentTest.results.testResults.totalTimeSeconds,e=currentTest.results.testResults;this.setProg(s/t);var r=[];r.push("Requests: "+e.totalRequests),r.push("Errors: "+e.totalErrors),r.push("Avg latency: "+Math.round(e.meanLatencyMs/100)/10+"s"),r.push("Max latency: "+Math.round(e.maxLatencyMs/100)/10+"s"),$("#currentResults").html(r.join(", "));var n=currentTest.results.testInfo.url;n.length>75&&(n=n.substr(0,73)+"...");var a=Math.round(e.totalRequests/s*3600),o=Math.round(e.totalRequests/s*86400),u=[];u.push('<table class="table table-condensed"><tr><th width="30%">Property</th><th>Result</th></tr>'),u.push("<tr class='info'><td>URL</td><td>"+n+"</td></tr>"),u.push("<tr class='success'><td>Requests</td><td>"+numeral(e.totalRequests).format("0,0")+"</td></tr>"),u.push('<tr class="danger"><td>Errors</td><td>'+numeral(e.totalErrors).format("0,0")+"</td></tr>"),u.push("<tr class='info'><td>Est. Requests per hour</td><td>"+numeral(a).format("0,0")+" requests</td></tr>"),u.push("<tr class='info'><td>Est. Requests per day</td><td>"+numeral(o).format("0,0")+" requests</td></tr>"),u.push("<tr><td>Test Duration</td><td>"+numeral(Math.round(10*s)/10).format("0,0")+" seconds</td></tr>"),u.push("<tr><td>Avg response latency</td><td>"+Math.round(e.meanLatencyMs/10)/100+" seconds</td></tr>"),u.push("<tr><td>Max response latency</td><td>"+Math.round(e.maxLatencyMs/10)/100+" seconds</td></tr>"),u.push("</table>"),$("#testResults").html(u.join(""))}else this.setProg(0)},progressor.prototype.setProg=function(t){t=Math.max(0,Math.min(t,1)),$("#proggy").css({width:100*t+"%"})};var currentTest={},statusChecker=function(){this.status="",this.checking=!1;var t=this,s=function(){t.checking||(t.checking=!0,$.ajax({type:"GET",url:"/jobstatus",success:function(s){s.status!=t.status&&(t.status=s.status,Display(s.zone)),currentTest.results=s,t.checking=!1,$("#ver").html(s.name+" "+s.ver),$("#vertop").html(s.ver)}}))};this.checkTimer=setInterval(s,2e3),s()};